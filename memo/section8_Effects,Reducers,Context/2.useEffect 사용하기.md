useEffect 사용하기

만약 어떠한 정보를 브라우저 저장소에 저장하고 컴포넌트가 리렌더링 될 때 해당값을 가져오고 싶을 때

const App = () => {

    const [isLoggedIn,setIsLoggedIn] = useState(false); // 1
    
    const storedValue = localStorage.getItem('isLoggedIn'); // 2

    if(storedValue === 'on') { 
        // 3
        setIsLoggedIn(true);
    }

    const handleLogin = () => {
        localStorage.setItem('isLoggedIn','on');
        setIsLoggedIn(true);
    }

    return (
        <>
            {
                isLoggedIn ? <span>Login !</span> : <button onClick={handleLogin}>Login</button>
            }
        </>
    )
}

위와 같은 코드는 최초 로그인 시 localStorage에 값을 저장하고 리렌더링 시 해당 값이 있으면
바로 로그인이 되게끔 하는 코드이다.
하지만 위 코드는 다음과 같은 무한루프를 돌게된다.

1. useState()로 isLoggedIn의 기본값을 false로 설정
2. localStorage에 isLoggedIn값을 가져옴.
3. 해당 값이 있으므로 setIsLoggedIn을 true로 설정
4. 상태값이 변했으므로 컴포넌트 리렌더링 후 1번부터 무한루프

해당 상황을 useEffect로 해결할 수 있다.

const App = () => {

    const [isLoggedIn,setIsLoggedIn] = useState(false); 

    console.log('first')

    const handleLogin = () => {
        localStorage.setItem('isLoggedIn','on');
        setIsLoggedIn(true);
    }

    useEffect(() => {
        <!-- 기존의 JS처럼 위에서부터 순차적으로 실행되는것이 아닌 컴포넌트의 JSX문 까지 실행된 후 해당 Effect가 실행된다. -->
        <!-- 해당 컴포넌트의 첫 실행시 의존성과 별개로 한번 실행된다. 그 이후로는 의존성에 의해서만 실행됨 -->
        const storedValue = localStorage.getItem('isLoggedIn'); 

        console.log('seconds')
        if(storedValue === 'on') { 
            setIsLoggedIn(true);
        }
    },[])

    return (
        <>
            {console.log('third')}
            {
                isLoggedIn ? <span>Login !</span> : <button onClick={handleLogin}>Login</button>
            }
        </>
    )
}

위의 코드는 console.log를 first - seconds - third 순으로 넣어줬지만
useEffect는 컴포넌트 리렌더링이 끝난 후 실행되기 때문에 실제로 출력 순서는 first - third - seconds 순으로 출력된다.