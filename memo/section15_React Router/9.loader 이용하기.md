이전까지는 페이지 렌더링 후 데이터 fetching 후 리렌더링 순으로 화면에 데이터를 표출해줬는데
react-router에서는 페이지가 렌더링되기전에 데이터를 fetching 해오는 기능을 지원한다.

라우트를 구성할 때 값으로 함수를 가지고있는 loader 프로퍼티를 추가해준다.
loader 프로퍼티가 추가된 페이지는 페이지 렌더링 전에 항상 loader 함수를 실행시킨다.

loader는 해당 함수에서 반환하는 모든 값을 자동으로 렌더링되고있는 페이지에 제공한다.

loader에서 반환하는 값은 해당 element에서 react-router-dom의 useLoaderData 훅을 사용해서 가져온다.
useLoaderData 훅은 가장 가까운 loader 데이터를 가져온다.

loader에서 반환하는 값은 해당 element 뿐만 아니라 하위에 children으로 추가된 라우트들에서도 
같은방식으로 사용할 수 있다.

loader 함수의 위치는 loader를 프로퍼티를 추가할 페이지 컴포넌트에 추가하는것을 권장한다.

ex)
<!-- App 컴포넌트 -->
import EventPage, { loader as eventsLoader } from './pages/Events

const router = createBrowserRouter([
    {
        path: '/',
        element: <Layout />,
        children: [
            { path: '', element: <HomePage />},
            {
                path: 'events',
                element: <EventsPage />,
                loader: eventsLoader
            }
        ]
    }
])

const App = () => {
    return <RouterProvider router={router} />
}

<!-- EventPage 컴포넌트 (http://localhost:3000/events) -->
import { useLoaderData } from 'react-router-dom'

const EventsPage = () => {
    const events = useLoaderData();
    <!-- loader에서 가져온 backend data 출력 -->
    console.log(events);

    return <></>
}

export default EventsPage;

export async function loader() {
    const response = await fetch(url);
    
    if(!response.ok) {
        return
    } else {
        const resData = await response.json();
        return resData.events;
    }
}

=====================================================================================

loader는 해당 페이지로 이동하기 시작할 때 호출된다.

페이지 이동(Link 클릭같은) -> loader 실행 -> 페이지 렌더링

만약 loader 함수에서 받아오는 데이터가 3초가 걸린다면 3초 동안은 화면에서 아무일도 발생하지 않고,
해당 데이터가 들어온 3초 뒤에 페이지 이동이 일어난다.

장점
loader 값을 사용할 페이지 컴포넌트에서 로딩 중 상태에 대한 처리를 할 필요가 없어짐

단점
loader가 데이터를 받아오는 동안 지연이 발생하고, 
사용자는 페이지 이동을 눌렀음에도 loader가 데이터를 받아올때까지 아무일도 일어나지 않는것처럼 보여짐

그렇기 때문에 loader를 사용할 때 react-router-dom에서 useNavigation훅을 제공하는데 이 훅은 
loader의 상태 즉 페이지 전환이 시작됐는지, 데이터가 도착하길 기다리고 있는지, 데이터가 도착했는지에 대한 상태를 알려준다.

useNavigation에서 반환하는 값은 객체 형식을 가지고있는데 해당 객체의 
state 프로퍼티의 값은 idle, loading, submitting으로나뉜다.

idle: 라우트 전환이 일어나지 않은 상태
loading: 전환이 일어나고 loading중인 상태
submitting: http 메소드를 이용한 라우팅 작업이 호출되는 중인 상태

일반적인 페이지 전환 순서
idle -> loading -> idle

http 메소드가 포함된 페이지 전환 순서
idle -> submitting -> loading -> idle

로딩 상태는 페이지 전환이 될 페이지가 아니라, 페이지 전환이 되기 이전의 페이지에 추가된다.

사용법
import { Outlet, useNavigation } from 'react-router-dom';

const Layout = () => {
    const navigation = useNavigation();

    navigation.state === 

    return (
        <>
            <Header />
            <main>
                <Outlet />
            </main>
        </>
    )
}